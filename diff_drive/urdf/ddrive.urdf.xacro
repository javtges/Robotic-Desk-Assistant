<?xml version="1.0"?>
<robot xmlns:xacro="http://wiki.ros.org/wiki/xacro" name="ddrive">

    <xacro:property name="ddrive" value="$(find diff_drive)/config/ddrive.yaml"/>
    <xacro:property name="drive" value="${load_yaml(ddrive)}"/>
    <xacro:property name="wheelW" value="${drive['wheelWidth']}"/>
    <xacro:property name="wheelR" value="${drive['wheelRadius']}"/>
    <xacro:property name="tW" value="${drive['topWheelWidth']}"/>
    <xacro:property name="tR" value="${drive['topWheelRadius']}"/>
    <xacro:property name="L" value="${drive['L']}"/>
    <xacro:property name="W" value="${drive['W']}"/>
    <xacro:property name="H" value="${drive['H']}"/>
    <xacro:property name='pi' value="3.14159"/>

    <!-- <xacro:include filename="$(find diff_drive)/urdf/ddrive.gazebo.xacro"/> -->


    <link name="base_link"/>


    <link name="leftWheel">

        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <mass value="2"/>
            <inertia ixx="${1/12*(3*wheelR*wheelR + wheelW*wheelW)}"  ixy="0"  ixz="0" iyy="${1/12*wheelR*wheelR}" iyz="0" izz="${1/12*(3*wheelR*wheelR + wheelW*wheelW)}" />
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="${pi/2} 0 0" />
            <geometry>
                <cylinder radius="${wheelR}" length="${wheelW}" />
            </geometry>
            <material name="blue_mat">
                <color rgba="0 0 1 1" />
            </material>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
            <geometry>
                <cylinder radius="${wheelR}" length="${wheelW}" />
            </geometry>
        </collision>

    </link>

    <link name="rightWheel">

        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <mass value="2"/>
            <inertia ixx="${1/12*(3*wheelR*wheelR + wheelW*wheelW)}"  ixy="0"  ixz="0" iyy="${1/12*wheelR*wheelR}" iyz="0" izz="${1/12*(3*wheelR*wheelR + wheelW*wheelW)}" />
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="${pi/2} 0 0" />
            <geometry>
                <cylinder radius="${wheelR}" length="${wheelW}" />
            </geometry>
            <material name="red_mat">
                <color rgba="1 0 0 1" />
            </material>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
            <geometry>
                <cylinder radius="${wheelR}" length="${wheelW}" />
            </geometry>
        </collision>

    </link>


    <link name="body">

        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <mass value="1"/>
            <inertia ixx="${1/12*(W*W + H*H)}"  ixy="0"  ixz="0" iyy="${1/12*(W*W+L*L)}" iyz="0" izz="${1/12*(H*H+L*L)}"/>
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <geometry>
                <box size="${L} ${W} ${H}"/>
            </geometry>
            <material name="red_mat">
                <color rgba="1 0 0 1" />
            </material>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
                <box size="${L} ${W} ${H}"/>
            </geometry>
        </collision>

    </link>

    <link name="topWheel">

        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <mass value="0.25"/>
            <inertia ixx="${1/12*(3*tR*tR + tW*tW)}"  ixy="0"  ixz="0" iyy="${1/12*tR*tR}" iyz="0" izz="${1/12*(3*tR*tR + tW*tW)}" />
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="${pi/2} 0 0" />
            <geometry>
                <cylinder radius="${tR}" length="${tW}" />
            </geometry>
            <material name="red_mat">
                <color rgba="1 0 0 1" />
            </material>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
            <geometry>
                <cylinder radius="${tR}" length="${tW}" />
            </geometry>
        </collision>

    </link>


    <link name="botWheel">

        <inertial>
            <origin xyz="0 0 0" rpy="0 0 0" />
            <mass value="0.25"/>
            <inertia ixx="${1/12*(3*tR*tR + tW*tW)}"  ixy="0"  ixz="0" iyy="${1/12*tR*tR}" iyz="0" izz="${1/12*(3*tR*tR + tW*tW)}" />
        </inertial>

        <visual>
            <origin xyz="0 0 0" rpy="${pi/2} 0 0" />
            <geometry>
                <cylinder radius="${tR}" length="${tW}" />
            </geometry>
            <material name="green_mat">
                <color rgba="0 1 0 1" />
            </material>
        </visual>

        <collision>
            <origin xyz="0 0 0" rpy="${pi/2} 0 0"/>
            <geometry>
                <cylinder radius="${tR}" length="${tW}" />
            </geometry>
        </collision>

    </link>



    <joint name="joint1" type="fixed">
        <parent link="base_link" />
        <child link="body" />
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <axis xyz="0 0 0"/>
    </joint>

<!-- red wheel -->
    <joint name="jointR" type="continuous">
        <parent link="body" />
        <child link="rightWheel" />
        <origin xyz="${-wheelR/2} ${(W/2)+wheelW/2} 0" rpy="0 0 0"/>
        <axis xyz="0 1 0"/>
    </joint>

<!-- blue wheel -->
    <joint name="jointL" type="continuous">
        <origin xyz="${-wheelR/2} ${(-W/2)-wheelW/2} 0" rpy="0 0 0" />
        <parent link="body" />
        <child link="leftWheel" />
        <axis xyz="0 1 0"/>
    </joint>

<!-- top wheel -->
    <joint name="jointT" type="fixed">
        <origin xyz="${L/2} 0 ${tR}" rpy="0 0 0" />
        <parent link="body" />
        <child link="topWheel" />
        <axis xyz="0 1 0"/>
    </joint>

<!-- bottom wheel -->
    <joint name="jointB" type="continuous">
        <origin xyz="${L/2} 0 ${-tR}" rpy="0 0 0" />
        <parent link="body" />
        <child link="botWheel" />
        <axis xyz="0 1 0"/>
    </joint>

</robot>